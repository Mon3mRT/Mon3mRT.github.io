<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Firebase Security Checker</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
    #log { background: #fff; padding: 15px; border-radius: 5px; box-shadow: 0 0 4px #ccc; }
    .success { color: green; }
    .error { color: red; }
    .info { color: blue; }
  </style>
</head>
<body>
  <h2>🔍 Firebase Security Test</h2>
  <button onclick="runTest()">🚀 Start Test</button>
  <div id="log"></div>

  <script>
    const config = {
      apiKey: "AIzaSyBIuGvvV-bGmlehshHWH0gR5njRWt0nSvs",
      authDomain: "type-mvp.firebaseapp.com",
      databaseURL: "https://type-mvp.firebaseio.com",
      projectId: "type-mvp",
      storageBucket: "type-mvp.appspot.com",
      messagingSenderId: "666570497602",
      appId: "1:666570497602:web:dca66c9dadecee56ef17db"
    };

    const log = (msg, type = 'info') => {
      const el = document.createElement('div');
      el.className = type;
      el.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      document.getElementById('log').appendChild(el);
      console.log(msg);
    };

    async function runTest() {
      document.getElementById('log').innerHTML = '';
      log('🚀 Initializing Firebase...', 'info');

      try {
        firebase.initializeApp(config);
        const auth = firebase.auth();
        const db = firebase.database();
        const fs = firebase.firestore();
        const storage = firebase.storage();

        log('✅ Firebase initialized successfully', 'success');

        // Anonymous login
        log('🔐 Attempting Anonymous Login...');
        const userCred = await auth.signInAnonymously();
        log(`✅ Logged in as ${userCred.user.uid}`, 'success');

        // Realtime DB Test
        log('📡 Testing Realtime Database...');
        try {
          const snap = await db.ref('/').limitToFirst(1).once('value');
          log(`✅ Realtime DB accessible: ${JSON.stringify(snap.val())}`, 'success');
        } catch (e) {
          log(`❌ Realtime DB access denied: ${e.message}`, 'error');
        }

        // Firestore Test
        log('🧠 Testing Firestore...');
        try {
          const snap = await fs.collection('users').limit(1).get();
          log(`✅ Firestore accessible: ${snap.size} docs`, 'success');
        } catch (e) {
          log(`❌ Firestore access denied: ${e.message}`, 'error');
        }

        // Storage Test
        log('📦 Testing Cloud Storage...');
        try {
          const files = await storage.ref().listAll();
          log(`✅ Storage accessible: ${files.items.length} items`, 'success');
        } catch (e) {
          log(`❌ Storage access denied: ${e.message}`, 'error');
        }

      } catch (e) {
        log(`❌ Firebase init failed: ${e.message}`, 'error');
      }
    }
  </script>
</body>
</html>
